version: "3.9"
services:
  handyman:
    container_name: handyman
    image: handyman
    ports:
      - "7070:7070"
    depends_on:
      - mongodb
      - postgres
    build: ../handyman
    environment:
      - grpc.server.address=0.0.0.0
      - spring.data.mongodb.uri=mongodb://mongodb:27017/handyman
      - grpc.client.landscape.address=dns:///landscape:9899
      - spring.datasource.url=jdbc:postgresql://postgres:5432/vogorode

  landscape:
    container_name: landscape
    image: landscape
    ports:
      - "8080:8080"
    depends_on:
      - postgres
    environment:
      - grpc.client.handyman.address=static://handyman:9898
      - grpc.client.rancher.address=static://rancher:9900
      - spring.datasource.url=jdbc:postgresql://postgres:5432/vogorode
      - grpc.server.address=0.0.0.0
    build: ../landscape

  rancher:
    container_name: rancher
    image: rancher
    ports:
      - "9090:9090"
    depends_on:
      - mongodb
      - postgres
    build: ../rancher
    environment:
      - grpc.server.address=0.0.0.0
      - spring.data.mongodb.uri=mongodb://mongodb:27017/rancher
      - grpc.client.landscape.address=dns:///landscape:9899
      - spring.datasource.url=jdbc:postgresql://postgres:5432/vogorode

  postgres:
    container_name: postgres
    image: postgis/postgis
    environment:
      - POSTGRES_DB=vogorode
      - POSTGRES_USER=username
      - POSTGRES_PASSWORD=password

  mongodb:
    container_name: mongodb
    image: mongo
